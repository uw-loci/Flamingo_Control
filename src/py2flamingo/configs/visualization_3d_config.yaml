# 3D Visualization Configuration
# This file defines all parameters for the 3D sample chamber visualization
# avoiding hardcoded values in the implementation

display:
  # Display resolution (what the user sees in napari)
  voxel_size_um: [15, 15, 15]  # micrometers per display voxel

  # Rendering settings
  fps_target: 30
  downsample_factor: 4  # Downsample live camera feed by this factor
  max_channels: 4
  rendering_backend: "napari"  # future: could be "vispy", "vtk"

  # Visual appearance
  chamber_wireframe_thickness: 2  # voxels
  objective_indicator_size: 20  # pixels
  rotation_axes_length: 30  # voxels

storage:
  # High-resolution storage (2-3x display resolution)
  # This preserves data quality during rotations
  voxel_size_um: [5, 5, 5]  # micrometers per storage voxel (3x finer than display)

  # Storage backend settings
  backend: "sparse"  # "sparse", "zarr", "hdf5"
  compression: "zstd"  # "none", "gzip", "zstd", "lz4"
  compression_level: 3

  # Memory management
  max_memory_mb: 2000
  cache_size_mb: 500
  use_memory_mapping: true

  # Chunking for efficient access
  chunk_size_voxels: [64, 64, 32]

sample_chamber:
  # Chamber dimensions and positioning
  # The chamber is positioned relative to the Y minimum stage position (anchor point)

  # Stage Y minimum position (anchor point in mm)
  y_min_anchor_mm: 5.0

  # Chamber extends below the anchor point (in mm)
  chamber_below_anchor_mm: 10.0  # 1cm below Y minimum

  # Chamber extends above the anchor point (in mm)
  chamber_above_anchor_mm: 5.0  # 5mm above Y minimum
  # Total chamber height = 10mm + 5mm = 15mm

  # Chamber dimensions based on stage travel ranges
  # X: 1.0mm to 12.31mm = 11.31mm width
  chamber_width_x_mm: 11.31  # X dimension (horizontal, left-right)
  chamber_x_offset_mm: 1.0   # X minimum position

  # Z: 12.5mm to 26mm = 13.5mm depth
  chamber_depth_z_mm: 13.5   # Z dimension (depth, toward objective)
  chamber_z_offset_mm: 12.5  # Z minimum position

  # Sample holder dimensions
  holder_diameter_mm: 1.0  # Diameter of the cylindrical holder
  # Holder extends from chamber top down to Y_min (and beyond, but we only display visible portion)

  # Visualization wall thickness (just for display, not physical)
  wall_thickness_mm: 1.0

  # Material properties
  material: "glass"
  refractive_index: 1.52

  # Sample region (where high-res data is stored)
  sample_region_radius_um: 3000  # Radius around center for high-res storage
  sample_region_center_um: [6000, 6000, 18000]  # Default center position (updated for new dimensions)

stage_control:
  # Physical stage ranges (in mm)
  # These define the chamber visualization bounds and stage movement limits
  x_range_mm: [1.0, 12.31]    # X axis: left-right
  y_range_mm: [-5.0, 10.0]    # Y axis: chamber extent (15mm total, anchor at 0mm)
  z_range_mm: [12.5, 26.0]    # Z axis: depth (toward objective)

  # Stage position limits (may differ from chamber bounds)
  y_stage_min_mm: 5.0         # Minimum stage position (collision prevention)
  y_stage_max_mm: 15.0        # Maximum stage position (can leave chamber)

  # Default positions (mm) - starting position for visualization
  x_default_mm: 6.655         # Center of X range
  y_default_mm: 5.0           # At minimum (1/3 down from chamber top)
  z_default_mm: 19.25         # Center of Z range

  # Axis inversion defaults (user preferences for stage control)
  # Set these based on your microscope's stage configuration
  invert_x_default: false     # If true, moving slider right moves stage left
  invert_z_default: false     # If true, moving slider right moves stage backward

  # Y-axis rotation configuration
  rotation_angle_offset_deg: 0.0    # Physical stage angle for "0 degrees" reference
  rotation_range_deg: [-180, 180]   # Allowed rotation range
  rotation_default_deg: 0.0         # Starting rotation angle

coordinate_mapping:
  # Napari origin definition (internal pixel coordinate system)
  napari_origin: "back_upper_left"  # (0,0,0) position in napari viewer

  # Axis mapping to napari display
  # Napari axes: Axis 0 (yellow), Axis 1 (magenta), Axis 2 (cyan)
  napari_axis_mapping:
    z: 0  # Z maps to napari Axis 0 (yellow) - depth slices
    y: 1  # Y maps to napari Axis 1 (magenta) - vertical
    x: 2  # X maps to napari Axis 2 (cyan) - horizontal

  # Axis inversions for user-friendly display
  invert_y_display: true  # Y increases "up" for user (internally inverted)

  # Slider colors matching napari axes (for GUI)
  axis_colors:
    x: "#00FFFF"  # Cyan (napari Axis 2)
    y: "#FF00FF"  # Magenta (napari Axis 1)
    z: "#FFD700"  # Gold/Yellow (napari Axis 0)

channels:
  # Laser line channel configurations
  # These represent fluorescent signals excited by different laser wavelengths
  - id: 0
    name: "405nm (DAPI)"
    default_colormap: "blue"
    default_visible: true
    update_strategy: "maximum"  # Maximum intensity projection for fluorescence
    blend_mode: "additive"
    opacity: 0.8

  - id: 1
    name: "488nm (GFP)"
    default_colormap: "green"
    default_visible: true
    update_strategy: "maximum"
    blend_mode: "additive"
    opacity: 0.8

  - id: 2
    name: "561nm (RFP)"
    default_colormap: "red"
    default_visible: true
    update_strategy: "maximum"
    blend_mode: "additive"
    opacity: 0.8

  - id: 3
    name: "640nm (Far-Red)"
    default_colormap: "magenta"
    default_visible: false
    update_strategy: "maximum"
    blend_mode: "additive"
    opacity: 0.8

rotation:
  # Rotation handling parameters
  interpolation_method: "linear"  # "nearest", "linear", "cubic"

  # Anti-aliasing during rotation
  enable_antialiasing: true
  antialias_kernel_size: 3

  # Rotation limits (degrees)
  limits:
    rx: [-180, 180]
    ry: [-180, 180]
    rz: [0, 360]  # Full rotation around Z

  # Default rotation center (can be calibrated)
  rotation_center_um: [5000, 5000, 21500]

coordinate_system:
  # Define coordinate system conventions
  axes_orientation: "right_handed"  # or "left_handed"

  # Axis definitions relative to microscope
  x_axis: "stage_left_right"
  y_axis: "stage_front_back"
  z_axis: "vertical_up"

  # Origin location
  origin: "chamber_bottom_center"

performance:
  # Performance optimization settings
  enable_gpu_acceleration: false  # Future: CUDA/OpenCL acceleration

  # Level of detail (LOD) for zooming
  enable_lod: true
  lod_levels: 3
  lod_distance_thresholds: [100, 500, 1000]  # voxels

  # Update throttling
  min_update_interval_ms: 33  # ~30 FPS max
  batch_update_size: 1000  # Max voxels per update batch

  # Background processing
  use_threading: true
  num_worker_threads: 2

data_persistence:
  # Auto-save settings
  enable_autosave: false
  autosave_interval_minutes: 10
  autosave_directory: "~/flamingo_3d_sessions"

  # Session management
  max_session_history: 10
  compress_saved_sessions: true

  # Export formats
  supported_export_formats: ["tiff", "hdf5", "zarr", "npy"]
  default_export_format: "tiff"

# Future multicamera support placeholder
multicamera:
  enabled: false  # Set to true when implementing X-SPIM support
  max_cameras: 2
  view_fusion_method: "weighted_average"  # "maximum", "deconvolution"
  registration_method: "fiducial"  # "fiducial", "correlation", "manual"